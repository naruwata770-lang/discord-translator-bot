# Discord自動翻訳bot - プロジェクト計画書

## プロジェクト概要

### 目的
Discordで中国人の友達と日本語⇔中国語で楽しくチャットできる環境を提供するため、メッセージを自動翻訳するbotを開発する。

### 背景
- 言語の壁により、コミュニケーションが制限されている
- 手動でコピー&ペーストして翻訳サービスを使うのは煩雑
- リアルタイムでスムーズな会話を実現したい

### 期待される効果
- 言語の壁を気にせず、ゲームやチャットを楽しめる
- 翻訳の手間がなくなり、会話がスムーズになる
- お互いの母国語で自然に話せる

---

## ターゲットユーザー

### プライマリユーザー
- 開発者本人（日本人、日本語話者）
- 中国人の友達（中国語話者）

### 使用シーン
- ゲームの雑談チャンネル
- 日常的な会話
- イベントやパーティーの打ち合わせ

---

## 機能要件

### MVP（Phase 1）: 最小限の機能

#### 必須機能
1. **コマンドベース翻訳**
   - コマンド: `!translate <テキスト>`
   - 言語を自動検出して翻訳
   - 日本語→中国語、中国語→日本語の相互翻訳

2. **Discord bot基本機能**
   - 特定のチャンネルでメッセージを監視
   - bot自身のメッセージは無視

3. **Poe API統合**
   - AI翻訳エンジンとしてPoe APIを使用
   - エラー時のフォールバック処理

4. **設定管理**
   - 環境変数でAPIキー・トークン管理
   - 翻訳対象チャンネルの設定

#### 非機能要件
- レスポンスタイム: 5秒以内（通常時）
- 可用性: 99%以上（Railway.app依存）
- セキュリティ: APIキー・トークンの安全な管理

---

### Phase 2: 機能拡張

#### 自動翻訳モード
- 特定チャンネルの全メッセージを自動翻訳
- トグルコマンドでON/OFF切り替え
- チャンネルごとの設定保存

#### 言語自動検出
- 入力テキストの言語を自動判定
- 検出精度の向上（franc、fasttext等）

#### 翻訳結果の表示改善
- 国旗絵文字表示（🇯🇵→🇨🇳）
- 元メッセージの引用
- スレッド形式での返信

#### エラーハンドリング強化
- API制限時のリトライ処理
- エラーメッセージの日本語化
- ログの充実化

---

### Phase 3: 運用・改善

#### デプロイ・運用
- Railway.appへの自動デプロイ
- GitHub Actions連携
- 環境変数の本番設定

#### モニタリング
- ログの構造化
- エラー率のモニタリング
- 翻訳回数の統計

#### 将来的な機能（検討中）
- 複数言語対応（英語、韓国語等）
- 専門用語辞書機能
- 翻訳履歴の保存
- ユーザーごとの設定

---

## 技術仕様

### 技術スタック

| カテゴリ | 技術 | 理由 |
|---------|------|------|
| **言語** | TypeScript | 型安全性、開発効率 |
| **ランタイム** | Node.js 20+ | 非同期I/O、Discord bot開発の標準 |
| **Discord API** | discord.js v14+ | 最も人気のあるライブラリ |
| **翻訳API** | Poe API | 高品質なAI翻訳（OpenAI互換） |
| **設定管理** | zod | 型安全なバリデーション |
| **ロガー** | pino | 高速な構造化ログ |
| **コンテナ** | Docker | 環境の統一、デプロイ容易化 |
| **ホスティング** | Railway.app | GitHub連携、自動デプロイ |
| **バージョン管理** | GitHub | コード管理、CI/CD |

### アーキテクチャ概要

```
Discord Message Event
    ↓
DiscordClient（イベント監視）
    ↓
MessageHandler（メッセージ処理）
    ↓
CommandParser（コマンド解析）
    ↓
TranslationService（翻訳実行）
    ↓
Poe API Client（API呼び出し）
    ↓
MessageDispatcher（結果送信）
    ↓
Discord Channel（翻訳結果表示）
```

### 外部API

#### Discord Bot API
- **用途**: Discordとの通信
- **認証**: Bot Token
- **制限**: メッセージ送信 50req/s、グローバル 50req/s

#### Poe API
- **エンドポイント**: `https://api.poe.com/v1/chat/completions`
- **認証**: Bearer Token
- **形式**: OpenAI互換API
- **制限**: プランによる（要確認）

---

## スケジュール

### Phase 0: プロジェクトセットアップ（1日）
- [x] プロジェクト計画書作成
- [ ] GitHub リポジトリ作成
- [ ] 技術仕様書作成
- [ ] 実装ガイド作成
- [ ] デプロイ手順書作成

### Phase 1: MVP開発（2-3日）
- [ ] プロジェクト初期化（package.json、tsconfig.json等）
- [ ] Discord bot基本実装
- [ ] Poe API統合
- [ ] コマンドベース翻訳実装
- [ ] ローカルでの動作確認

### Phase 2: 機能拡張（2-3日）
- [ ] 自動翻訳モード実装
- [ ] 言語自動検出
- [ ] エラーハンドリング強化
- [ ] ログ機能実装

### Phase 3: デプロイ・運用（1-2日）
- [ ] Dockerfile作成
- [ ] Railway.app設定
- [ ] 本番環境デプロイ
- [ ] 動作確認・調整

**合計見積もり**: 約1週間（実働時間）

---

## リスク管理

### 技術的リスク

| リスク | 影響度 | 対策 |
|--------|--------|------|
| Poe API制限 | 高 | レート制限実装、エラーハンドリング |
| Discord API制限 | 中 | メッセージ送信のキューイング |
| 翻訳精度の問題 | 中 | プロンプト調整、モデル選択 |
| Railway.app障害 | 低 | ログ監視、アラート設定 |

### 運用リスク

| リスク | 影響度 | 対策 |
|--------|--------|------|
| APIコスト増加 | 中 | 使用量モニタリング、上限設定 |
| bot停止 | 高 | Railway.appの自動再起動、ヘルスチェック |
| 不適切な翻訳 | 低 | ログ確認、フィードバック収集 |

---

## 成功指標

### Phase 1（MVP）
- ✅ コマンドベース翻訳が動作する
- ✅ 日本語⇔中国語の相互翻訳ができる
- ✅ エラーが適切にハンドリングされる
- ✅ ローカルで安定動作する

### Phase 2（機能拡張）
- ✅ 自動翻訳モードが動作する
- ✅ 言語が自動検出される
- ✅ 翻訳精度が実用レベル（体感で十分）
- ✅ エラー率が5%以下

### Phase 3（本番運用）
- ✅ Railway.appで24時間稼働
- ✅ 友達と実際にチャットで使える
- ✅ レスポンスタイムが5秒以内
- ✅ 月間コストが予算内（$10以下）

---

## 参考資料

- [discord.js公式ドキュメント](https://discord.js.org/)
- [Poe API公式ドキュメント](https://developer.poe.com/)
- [Railway.app公式ドキュメント](https://docs.railway.app/)
- サンプルプロジェクト: `/workspace/sample/chromeextensionhonyaku/`（Poe API使用例）

---

## 変更履歴

| 日付 | 版 | 変更内容 | 作成者 |
|------|---|---------|--------|
| 2025-10-17 | 1.0 | 初版作成 | Claude Code |

---

**次のステップ**: 技術仕様書（TECHNICAL_SPECIFICATION.md）の作成
